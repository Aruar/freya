//--------------------------------------------------------------
//               (c)2004-2007 Freya Team Presents:              
//                  ___                                         
//                 /   |_   _ _ __ ___  _ __ __ _               
//                / /| | | | | '__/ _ \| '__/ _` |              
//               / ___ | |_| | | | (_) | | | (_| |              
//              /_/  |_|\____|_|  \___/|_|  \__,_|              
//                    http://www.ro-freya.net                   
//--------------------------------------------------------------
// Script Title: Ice Cave Ktullanux Quest	Author: henhouse
//--------------------------------------------------------------
// Revision History: v1.1
//--------------------------------------------------------------
//	1.0 First version [henhouse]
//	1.1 Improved formatting + converted to Aurora [Tsuyuki]
//--------------------------------------------------------------
// Additional Notes: Quest is semi-accurate and highly
// unofficial, but it does what it should.
//--------------------------------------------------------------


rachel.gat,157,183,3	script	Follower Ustialla	916,{

	if (KTULLQ == 5 && countitem(7572)) goto L_GiveNecklace;
	if (KTULLQ >= 5) goto L_QuestCompleted;
	if (KTULLQ >= 1) goto L_Helpout2;

	cutin "ra_usti1",2;
	mes "[Ustialla]";
	mes "May the blessings of Freya be with you...";
	next;
	mes "[Ustialla]";
	mes "A visitor from a far away land...! Surely it was Freya's will you be guided to Arunafeltz, yes... That must be it.";
	next;
	mes "[Ustialla]";
	mes "We are followers of Freya, you see. She is our goddess... A shepherd of us humble humans!";
	next;
	mes "[Ustialla]";
	mes "Oh, Freya... But I must know, what brings you here foreigner?";
	next;
	menu "I'm here to receive the teachings of Freya",-,"I'm just here on tour",L_menu2;

	mes "[Ustialla]";
	mes "Of course you are! The day our all-knowing Freya is resurrected... she shall lead all of us to a land of everlasting beauty and providence.";
	next;
	mes "[Ustialla]";
	mes "She blesses us all! May her majesty grace you as well. Yes, may Freya be with you as she is with us... Always and forever!";
	next;
	mes "[Ustialla]";
	mes "But for now our protector sleeps. Oh Freya!! What do you dream in your peaceful slumber?";  
	next;
	mes "[Ustialla]";
	mes "You see, a long, long time ago during the times of the Thousand Year War, Freya waged a war against terrible demons for our sake.";
	next;
	mes "[Ustialla]";
	mes "Although she was victorious, she was also very exhausted. She promised humanity she would return one day and bless us once more with her presense.";
	next;
	mes "[Ustialla]";
	mes "Now she rests in a realm of uncomprehendible beauty, where only the most righteous souls may be witness to her countenance.";
	next;
	mes "[Ustialla]";
	mes "When she dreams, she appears to us in a physical form in Midgard, a being with hair white as freshly-fallen snow and and the fairest features ever seen.";
	next;
	mes "[Ustialla]";
	mes "It is none other than our Pope! The human embodiment of Freya, may she be blessed always and forever...";
	next;
	mes "[Ustialla]";
	mes "That is the truth that all followers of Freya know by heart. Oh, Freya...!";
	next;
	mes "[Ustialla]";
	mes "My dear guest from afar, I beg you... Will you heed a request from me?";
	next;
	mes "[Ustialla]";
	mes "Freya is a goddess of beauty, of love, grace and peace ... All beautiful things in the world are her making.";
	next;
	mes "[Ustialla]";
	mes "A while ago I attained a precious necklace made by Dwarves, rarely seen masters of forgery.";
	next;
	mes "[Ustialla]";
	mes "The strange pawn shop owner sold to to me for a cheap price, even though he said he went through a lot of trouble to get it...";
	next;
	mes "[Ustialla]";
	mes "If I was able to get this necklace to shine brighter, I have no doubt Freya would bless us for our troubles ... Will you please help me?";
	next;
	mes "[Ustialla]";
	mes " ... ";
	next;
	menu "Sorry, but I'd rather not get involved.",-,"Leave it up to me.",L_Helpout;
	mes "[Ustialla]";
	mes "Oh.. I see.. I guess even if we share the same faith, we're just strangers in the end, aren't we...";
	cutin "ra_usti1",255;
	close;

L_menu2: 
	mes "[Ustialla]";
	mes "Visit the Sanctuary, a monument to our savior, our goddess... Ohh, Freya...!";
	cutin "ra_usti1",255;
	close;

L_Helpout:
	mes "[Ustialla]";
	mes "Bless you! Bless you! A magician by the name of ^3366FFMaheo^000000 left for the Ice Caves up north.";
	next;
	mes "[Ustialla]";
	mes "He hasn't been seen or heard from for days since he left, but you must find him! Because I'm positive he'll have the capability to make this necklace glow bright once more."; 
	next;
	mes "[Ustialla]";
	mes "Please, take the necklace with you and find him! May the will of Freya guide you safely..."; 
	getitem 7572,1;
	set KTULLQ,1;
	cutin "ra_usti1",255;
	close;

L_Helpout2:
	cutin "ra_usti1",2;
	mes "[Ustialla]";
	mes "A magician by the name of ^3366FFMaheo^000000 left for the Ice Caves up north.";
	next;
	mes "[Ustialla]";
	mes "He hasn't been seen or heard from for weeks since then, but you must find him! Because I'm positive he'll know how to make this necklace glow bright once more."; 
	next;
	mes "[Ustialla]";
	mes "Please, take the necklace with you and find him! May the will of Freya guide you safely..."; 
	cutin "ra_usti1",255;
	close;

L_GiveNecklace:
	cutin "ra_usti1",2;
	mes "[Ustialla]";
	mes "Oh, hello foreigner... What's that?";
	next;
	mes "[Ustialla]";
	mes "The necklace! It looks... Wonderful! Spectacular! Oh... Freya!";
	next;
	mes "[Ustialla]";
	mes "Bless your soul... It's beautiful.";
	next;
	mes "[Ustialla]";
	mes "I promise to donate the necklace to the Sanctuary in our name, and I'm sure Freya will be most pleased with our efforts.";
	next;	
	mes "[Ustialla]";
	mes "Please, have this as a gift from me. You may be new to our ways, foreigner, but you feel like a sibling to me!";
	delitem 7573,1;
	set BaseExp,BaseExp +500000;
	set JobExp,JobExp +200000;
	cutin "ra_usti1",255;
	close;

L_QuestCompleted:
	cutin "ra_usti1",2;
	mes "[Ustialla]";
	mes "My friend, we are all the children of Freya's love.";
	next;
	mes "[Ustialla]";
	mes "Ohh, Freya...!";
	emotion e_lv;
	cutin "ra_usti1",255;
	close;
}

ice_dun02.gat,1,1,1	script	KtullDisabler 	139,{

OnInit:
	disablenpc "KtullMagician";
	end;

}

ice_dun02.gat,120,103,3	script	#KtullFreeze	924,{

	cutin "ra_magic1",2;
	mes "This magician is frozen completely in ice...";
	next;
	if (KTULLQ == 1) goto L_FindMaster;
	if (KTULLQ == 2) goto L_FindMaster2; 
	if (KTULLQ == 4) goto L_FindMaster3; 
	if (KTULLQ == 5) goto L_FindMaster4; 
	if (KTULLQ == 1) goto L_FindMaster; 
	mes "He must be awfully cold!";
	cutin "ra_magic1",255;
	close;

L_FindMaster:
	mes "It seems he's still alive!";
	next;
	cutin "ra_magic4",2;
	mes "[Magician Maheo]";
	mes "Hey you, yeah, you!";
	next;
	mes "[Magician Maheo]";
	mes "Heh, surprised you didn't I? Guess you've never talked to a frozen guy before huh?";
	next;
	mes "[Magician Maheo]";
	mes "No, don't try to hit me with your weapon or set fire to me or anything, that won't help at all... This ice is much stronger than normal ice, trust me.";
	next;
	cutin "ra_magic2",2;
	mes "[Magician Maheo]";
	mes "If you want to help me out of here then pay attention and pay attention good:";
	next;
	mes "[Magician Maheo]";
	mes "Go into the town of Rachel. My teacher, a man by the name of Haiton is there. Look for him.";
	next;
	mes "[Magician Maheo]";
	mes "He's usually by the pond, but if you can, explain to him my situation and he'll tell you what to do to get me out of here, I'm sure of it.";
	next;
	mes "[Magician Maheo]";
	mes "He's never let me down before...";
	cutin "ra_magic2",255;
	set KTULLQ,2;
	close;

L_FindMaster2:
	cutin "ra_magic2",2;
	mes "[Magician Maheo]";
	mes "If you want to help me out of here then listen good:";
	next;
	mes "[Magician Maheo]";
	mes "Go into the town of Rachel. My teacher, a man by the name of Haiton is there. Look for him.";
	next;
	mes "[Magician Maheo]";
	mes "He's usually sitting by the pond. If you can, explain to him my situation and he'll tell you what to do to get me out of here, I'm sure of it.";
	next;
	mes "[Magician Maheo]";
	mes "He's never let me down before.";
	cutin "ra_magic2",255;
	close;

L_FindMaster3:
	if (!countitem(7569)) goto L_NoItem;
	cutin "ra_magic3",2;
	mes "[Magician Maheo]";
	mes "What took you so long? I'm freezing here! The least you could do it hurry up...";
	next;
	mes "[Magician Maheo]";
	mes "So, what did Haiton say? ...";
	next;
	cutin "ra_magic2",2;
	mes "[Magician Maheo]";
	mes "Hammer of Wind, huh? Think it's strong enough to break this ice off me?";
	next;
	mes "[Magician Maheo]";
	mes "Well, lets give it a good college try. In fact, give it all you got!";
	next;
	mes "[Magician Maheo]";
	mes "Ready...?";
	mes "one...";
	mes "two...";
	mes "THREE!!!";
	next;
	mes "You swing the hammer and upon impact, it shatters the ice off of the Magician.";
	close2;
	delitem 7569,1;

	misceffect "#KtullFreeze",135;
	misceffect "#KtullFreeze",522;
	enablenpc "KtullMagician";
	cutin "ra_magic2",255;
	disablenpc "#KtullFreeze";
	end;

L_NoItem:
	cutin "ra_magic3",2;
	mes "[Magician Maheo]";
	mes "Didn't you find a way to break this ice?";
	cutin "ra_magic3",255;
	close;

L_FindMaster4:
	cutin "ra_magic3",2;
	mes "This magician is frozen completely in ice...";
	next;
	mes "There's nothing you can do for him now...";
	cutin "ra_magic3",255;
	close;
}

ice_dun02.gat,120,103,3		script		Magician::KtullMagician		937,{

	mes "[Magician Maheo]";
	mes "MUAHAHAHAHHHA! I'm free!";
	next;
	mes "[Magician Maheo]";
	mes "At long last... Thank you!";
	next;
	mes "[Magician Maheo]";
	mes "I guess the least I can do is thank you for freeing me.";
	next;
	mes "[Magician Maheo]";
	mes "See, the reason I came here was to release a creature called ^3366FFKtullanux^000000...";
	next;
	mes "[Magician Maheo]";
	mes "Some say the goddess Freya sealed it in the depths of this cave to prevent it from spreading an everlasting winter across the land.";
	next;
	mes "[Magician Maheo]";
	mes "To release it, you must take bags of enchanted ^3366FFIce Powder^000000 to the third floor and sprinkle them on ^3366FFfour glowing crystals^000000.";
	next;
	mes "[Magician Maheo]";
	mes "The powder has other uses, such as ^3366ffbringing light back to old things^000000... If you had something old and grey, I might be able to make it shine for you for setting me free.";
	next;
	mes "[Magician Maheo]";
	mes "But do you have anything like that I could use this powder on?";
	next;
	if (countitem(7572)) {
		mes "[Magician Maheo]";
		mes "Hmmm, I see! That necklace will do fine...";
		next;
		mes "Maheo takes the powder and sprinkles a small amount upon the Grey Necklace.";
		next;
		mes "It glows a brilliant, icey blue color.";
		misceffect 348;
		delitem 7572,1;
		getitem 7573,1;
		next;
		mes "[Magician Maheo]";
		mes "There, now I don't owe you anything.";
		next;
		goto L_GetPowder;
	}
	else
		close;

L_GetPowder:
	mes "[Magician Maheo]";
	mes "I was going to use the rest of this powder for releasing Ktullanux, you can have it to do with as you please. Here...";
	next;
	getitem 7574,4;
	next;
	mes "[Magician Maheo]";
	mes "Have a blast with them, cause I'm outta here...!";
	next;
	mes "A frigid gust of wind swoops from behind you and blows on the Magician... Ice starts to form on him!";
	next;
	mes "[Magician Maheo]";
	mes "AHHH, not AGAIN!!";
	close2;
	set KTULLQ,5;
	enablenpc "#KtullFreeze";
	disablenpc "KtullMagician";
	end;
}

rachel.gat,265,98,3	script	Haiton	930,{

	if (KTULLQ == 2) goto L_Master1; 
	if (KTULLQ == 3) goto L_Master2; 
	if (KTULLQ >= 4) goto L_Master3; 
	mes "[Haiton]";
	mes "I'm busy, ask someone else if you need touring, foreigner...";
	close;

L_Master1:
	mes "[Haiton]";
	mes "I'm busy, ask someone else if you need touring, foreigner...";
	next;
	mes "[Haiton]";
	mes "...";
	next;
	mes "[Haiton]";
	mes "Oh, what? Maheo? What about him.";
	next;
	mes "[Haiton]";
	mes "...";
	next;
	mes "[Haiton]";
	mes "He's in the Ice Caves? Frozen solid? Not 'ordinary' ice he says?";
	next;
	mes "[Haiton]";
	mes "...Ugh, that idiot.";
	next;
	mes "[Haiton]";
	mes "Alright, here's what needs to be done...";
	next;
	mes "[Haiton]";
	mes "I can make a weapon that's capable of breaking any ice, regardless of how hard it is, but I'll need the items to make it first!";
	next;
	mes "[Haiton]";
	mes "So be good and get me the following stuff:";
	next;
	mes "[Haiton]";
	mes "1 Hammer [2],";
	mes "5 Rough Winds, and";
	mes "1 Empty Scroll.";
	next;
	mes "[Haiton]";
	mes "You can buy the hammer at any regular weaponry shop, even the one here on the eastern part of town. The scroll you can buy for pretty cheap at the Yuno Sage school.";
	next;
	mes "[Haiton]";
	mes "Be quick though. I don't have all day.";
	set KTULLQ,3;
	close;

L_Master2:
	mes "[Haiton]";
	mes "Have what I need to make the weapon?";
	next;
	menu "I got them.",L_HaveItems1,"No, not yet.",-;
	mes "[Haiton]";
	mes "Be quick about it, then. I don't have all day.";
	close;

L_HaveItems1:
	mes "[Haiton]";
	if ((countitem(1354)<1) || (countitem(996)<5) || (countitem(7433)<1)) {
		mes "I don't see all the items on you...";
		close;
	}
	mes "Alright, good work.";
	next;
	mes "[Haiton]";
	mes "Now just give me a second to make the weapon...";
	delitem 1354,1;
	delitem 996,5;
	delitem 7433,1;
	next;
	mes "*Hammer hammer*";
	next;
	getitem 7569,1;
	mes "[Haiton]";
	mes "Here. This will break the ice, no problem. It's a hammer that's infused with the power of wind.";
	next;
	mes "[Haiton]";
	mes "You can only use its power once before it crumbles away though, so don't waste it.";
	set KTULLQ,4;
	close;

L_Master3:
	mes "[Haiton]";
	mes "The hammer of wind will break the ice, no problem.";
	next;
	mes "[Haiton]";
	mes "You can only use its power once before it crumbles away though, so I hope you don't waste it.";
	close;
}

// Crystal 1
ice_dun03.gat,127,172,0	script	Crystal#KtullCrys1	111,{

	mes "There is a large crystal here.";
	next;
	if(KTULLQ == 6 && (countitem(7574) >= 1))
	{
		mes "Do you wish to sprinkle a whole bag of Ice Powder on it?";
		next;
		menu "Sprinkle the Ice Powder",L_Sacrifice1,"Don't do anything.",L_End1;
	}
	else {
		mes "It possesses a strange yet mezmerizing aura.";
		close;
	}
  
L_Sacrifice1:
	delitem 7574,1;
	mes "The crystal glows with a bright ^8C79ADwhite aura^000000. You only have 3 bags of Ice Powder left.";
	close2;
	addtimer 300000,"KtullTimer::OnTooLate";
	set KTULLQ,7;
	disablenpc "Crystal#KtullCrys1";
	end;

L_End1:
	mes "You left the crystal alone.";
	close;
}

// Crystal 2
ice_dun03.gat,127,126,0	script	Crystal#KtullCrys2	111,{

	mes "There is a large crystal here.";
	next;
	if(KTULLQ == 7 && (countitem(7574) >= 1))
	{
		mes "Do you wish to sprinkle a whole bag of Ice Powder on it?";
		next;
		menu "Sprinkle the Ice Powder",L_Sacrifice2,"Don't do anything.",L_End2;
	}
	else {
		mes "It possesses a strange yet mezmerizing aura.";
		close;
	}

L_Sacrifice2:
	delitem 7574,1;
	mes "The crystal glows with a bright ^8C79ADwhite aura^000000. You only have 2 bags of Ice Powder left.";
	close2;
	set KTULLQ,8;
	disablenpc "Crystal#KtullCrys2";
	end;

L_End2:
	mes "You left the crystal alone.";
	close;
}

// Crystal 3
ice_dun03.gat,172,126,0	script	Crystal#KtullCrys3	111,{

	mes "There is a large crystal here.";
	next;
	if (KTULLQ == 8 && (countitem(7574) >= 1)) {
		mes "Do you wish to sprinkle a whole bag of Ice Powder on it?";
		next;
		menu "Sprinkle the Ice Powder",L_Sacrifice3,"Don't do anything.",L_End3;
	}
	else {
		mes "It possesses a strange yet mezmerizing aura.";
		close;
	}
  
L_Sacrifice3:
	delitem 7574,1;
	mes "The crystal glows with a bright ^8C79ADwhite aura^000000. You only have 1 bag of Ice Powder left.";
	close2;
	set KTULLQ,9;
	disablenpc "Crystal#KtullCrys3";
	end;

L_End3:
	mes "You left the crystal alone.";
	close;
}

// Crystal 4
ice_dun03.gat,172,173,0	script	Crystal#KtullCrys4	111,{

	mes "There is a large crystal here.";
	next;
	if(KTULLQ == 9 && (countitem(7574) >= 1))
	{
		mes "Do you wish to sprinkle a whole bag of Ice Powder on it?";
		next;
		menu "Sprinkle the Ice Powder",L_Sacrifice4,"Don't do anything.",L_End4;
	}
	else {
		mes "It possesses a strange yet mezmerizing aura.";
		close;
	}
  
L_Sacrifice4:
	delitem 7574,1;
	mes "The crystal glows with a bright ^8C79ADwhite aura^000000. With all four crystals glowing, Ktullanux is released.";
	close2;
	set KTULLQ,10;
	areamonster "ice_dun03.gat",118,118,182,182,"Ktullanux",1779,1,"Icedun03monster::OnKtullDead";
	disablenpc "Crystal#KtullCrys4";
	end;

L_End4:
	mes "You left the crystal alone.";
	close;

// This 24 hour timer goes off whether the player is on or not.
// Whether or not they've killed Ktullanux does not matter.
// Only thing it cannot do is put their var back to 0 if they didn't kill him and logged.
// If they killed him, works. 
// This timer essentially limits how many Ktullanuxes can be made to one per day as Gravity intended.

OnTimer86400000:
	killmonster "ice_dun03.gat","Icedun03monster::OnKtullDead";
	enablenpc "Crystal#KtullCrys1";
	enablenpc "Crystal#KtullCrys2";
	enablenpc "Crystal#KtullCrys3";
	enablenpc "Crystal#KtullCrys4";
	set KTULLQ,0;
	end;
}

ice_dun03.gat,1,1,1	script	KtullTimer	139,{

OnTooLate:
	if (KTULLQ == 10) end;
	set KTULLQ,0;
	enablenpc "Crystal#KtullCrys1";
	enablenpc "Crystal#KtullCrys2";
	enablenpc "Crystal#KtullCrys3";
	end;

OnTimerQuit:
	set KTULLQ,0;
	enablenpc "Crystal#KtullCrys1";
	enablenpc "Crystal#KtullCrys2";
	enablenpc "Crystal#KtullCrys3";
	end;
}

ice_dun03.gat,1,1,1	script	Icedun03monster	-1,{

OnKtullDead:
	set KTULLQ,0;
	end;
}
